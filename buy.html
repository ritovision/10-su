---
layout: null
---
<!doctype html>
<html lang="en" class="mint-page">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Su Squares, mint a square</title>
  <link rel="canonical" href="https://tenthousandsu.com/buy" />
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/buy.css">
  <link rel="stylesheet" href="assets/css/chooser.css">
  <link rel="stylesheet" href="assets/web3/tx/styles.css">
  {% include nav-menu-head.html %}
  {% include alert-modal-head.html %}
  {% include offline-modal-head.html %}
</head>

<body>
  {% include nav-header.html desktop_button_one_label="Personalize" desktop_button_one_href="/personalize" %}
  <article class="lead">
    <h1>Mint Su Squares <span id="square-number-with-number-sign"></span></h1>
    <p><em>If you have a question, please mail <a
          href="mailto:Su@TenThousandSu.com?subject=Sales%20question&body=HiSu,%20Please%20help!%20I%20have%20a%20question%20about%20Su%20Squares.">Su@TenThousandSu.com</a>.</em>
    </p>

    <div id="pick-a-square">
      <h2>Which Square would you like?</h2>
      <p><strong>Square number</strong> (between 1 and 10,000)</p>
      <div class="square-lookup__controls">
        <input id="square-number" type="number" min="1" max="10000" required style="width:7em" placeholder="e.g. 2345">
        <div class="square-lookup__actions">
          <button id="square-choose-list" type="button">Choose from list</button>
          <button id="square-choose-canvas" type="button">Choose from canvas</button>
        </div>
      </div>
      <button id="select-square" type="button" class="btn btn-lg">Select Square</button>
    </div>

    <div id="mint-selected-square" style="display:none">
      <p>Please connect your wallet using the button above and then click mint below.</p>
      <div class="wallet-actions">
        <button id="open-wallet-app" type="button" class="btn btn-lg">Open mobile wallet</button>
        <button id="mint" type="button" class="btn btn-lg">Mint Square</button>
      </div>
    </div>

    <div id="mint-success" style="display:none">
      <p>Your Square is minted.</p>
      <div class="wallet-actions">
        <a id="personalize-now" class="btn btn-lg" href="/personalize">Personalize Now</a>
        <button id="mint-another" type="button" class="btn btn-lg">Mint Another</button>
      </div>
    </div>

    <p>Your purchase is subject to the terms, and your understanding of, our <a href="/white-paper">white paper</a>.</p>

    <div id="tx-fixture"></div>
  </article>

  <footer>
    <small>
      No cookies. No analytics. To the extent possible under law, Su Entriken has waived all copyright and related or
      neighboring rights to the TenThousandSu.com website. This work is published from the United States.
    </small>
  </footer>

  <script type="module">
    import {
      ensureConnected,
      ensureCorrectNetwork,
      openWalletFromStore,
      hasWalletConnectSession,
    } from "/assets/web3/foundation.js";
    import { createTxFixture } from "/assets/web3/tx/index.js";
    import { getWeb3Config } from "/assets/web3/config.js";
    import { purchaseSquare } from "/assets/web3/services/primary.js";
    import { buildTxUrl } from "/assets/web3/services/explorer-links.js";
    import { attachListChooser } from "/assets/js/choosers/list-chooser.js";
    import { attachCanvasChooser } from "/assets/js/choosers/canvas-chooser.js";
    import { loadSquareData } from "/assets/js/square-data.js";

    // Elements and state //////////////////////////////////////////////////////////////////////////////////////////////
    const squareNumberWithNumberSignSpan = document.getElementById("square-number-with-number-sign");
    const squareNumberInput = document.getElementById("square-number");
    const chooseListButton = document.getElementById("square-choose-list");
    const chooseCanvasButton = document.getElementById("square-choose-canvas");
    const mintButton = document.getElementById("mint");
    const pickASquareDiv = document.getElementById("pick-a-square");
    const mintSelectedSquareDiv = document.getElementById("mint-selected-square");
    const mintSuccessDiv = document.getElementById("mint-success");
    const personalizeNowLink = document.getElementById("personalize-now");
    const mintAnotherButton = document.getElementById("mint-another");
    const openWalletButton = document.getElementById("open-wallet-app");
    const txFixtureDiv = document.getElementById("tx-fixture");
    const { pricing } = getWeb3Config();
    const txUi = createTxFixture({
      target: txFixtureDiv,
      pricing,
      title: "Mint status",
    });
    let squareNumber;
    let squarePersonalizations;
    let squareExtra;
    let lastMintedSquare = null;

    const buildPersonalizeHref = (squareId) => {
      if (!squareId) return "/personalize";
      return `/personalize?square=${squareId}#${squareId}`;
    };

    const showMintState = () => {
      mintSuccessDiv.style.display = "none";
      pickASquareDiv.style.display = "block";
      mintSelectedSquareDiv.style.display = "none";
      squareNumberInput.value = "";
      squareNumber = null;
      txUi.reset();
    };

    const showSuccessState = (squareId) => {
      pickASquareDiv.style.display = "none";
      mintSelectedSquareDiv.style.display = "none";
      mintSuccessDiv.style.display = "block";
      const href = buildPersonalizeHref(squareId);
      personalizeNowLink.href = href;
    };

    // Load square data for availability checks ////////////////////////////////////////////////////////////////////////
    loadSquareData().then(({ personalizations, extra }) => {
      squarePersonalizations = personalizations;
      squareExtra = extra;
    }).catch((error) => {
      console.error("Failed to load square data", error);
    });

    // Attach choosers /////////////////////////////////////////////////////////////////////////////////////////////////
    if (chooseListButton) {
      attachListChooser({
        input: squareNumberInput,
        trigger: chooseListButton,
        filter: (_id, ctx) => !ctx.extra, // only unminted
        title: "Choose an available Square",
        description: "Only unminted Squares are shown.",
      });
    }

    if (chooseCanvasButton) {
      attachCanvasChooser({
        input: squareNumberInput,
        trigger: chooseCanvasButton,
        filter: (_id, ctx) => !ctx.extra, // only unminted
        title: "Choose square from canvas",
      });
    }

    // Validate Square number //////////////////////////////////////////////////////////////////////////////////////////
    squareNumberInput.addEventListener("input", () => {
      squareNumber = null;
      const value = parseInt(squareNumberInput.value);
      if (isNaN(value) || value < 1 || value > 10000) {
        return alert("Invalid Square number, please enter a number between 1 and 10000.");
      }
      squareNumber = value;
    });

    // Handle select Square button /////////////////////////////////////////////////////////////////////////////////////
    document.getElementById("select-square").addEventListener("click", () => {
      if (!squareNumber) {
        return alert("Please enter a Square number.");
      }
      // If the personalizations are loaded, check that the Square is available
      if (squareExtra && squareExtra[squareNumber - 1]) {
        return alert("Sorry, Square " + squareNumber + " was already purchased.");
      }
      if (squarePersonalizations && squarePersonalizations[squareNumber - 1]) {
        return alert("Sorry, Square " + squareNumber + " was already purchased.");
      }
      pickASquareDiv.style.display = "none";
      mintSelectedSquareDiv.style.display = "block";
      squareNumberWithNumberSignSpan.innerText = "#" + squareNumber;
    });

    if (mintAnotherButton) {
      mintAnotherButton.addEventListener("click", () => {
        showMintState();
      });
    }

    // Handle ?square= query parameter /////////////////////////////////////////////////////////////////////////////////
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has("square")) {
      squareNumberInput.value = urlParams.get("square");
      squareNumberInput.dispatchEvent(new Event("input"));
      //document.getElementById("select-square").click(); let the customer click it, by then the personalizations will be loaded
    }

    const updateOpenWalletButton = () => {
      if (!openWalletButton) return;
      const hasSession = hasWalletConnectSession();
      openWalletButton.style.display = hasSession ? "inline-block" : "none";
    };

    const triggerWalletDeepLink = () => {
      if (hasWalletConnectSession()) {
        openWalletFromStore();
      }
    };

    if (openWalletButton) {
      updateOpenWalletButton();
      window.addEventListener("su-wc-session-change", (event) => {
        const hasSession = Boolean(event?.detail?.hasSession);
        openWalletButton.style.display = hasSession ? "inline-block" : "none";
      });
      openWalletButton.addEventListener("click", () => {
        if (!openWalletFromStore()) {
          alert("No WalletConnect session found yet. Tap Connect Wallet first.");
        }
      });
    }

    // Handle mint button ///////////////////////////////////////////////////////////////////////////////////////////////
    mintButton.addEventListener("click", async () => {
      if (!squareNumber) {
        return alert("Please enter a Square number.");
      }
      triggerWalletDeepLink();
      txUi.startProcessing(`Minting Square #${squareNumber}. Confirm in your wallet to continue.`);
      const doSendTransaction = async (wagmi) => {
        txUi.setWalletContext({
          hasSession: hasWalletConnectSession(),
          isWalletConnect: wagmi?.getAccount?.()?.connector?.id === "walletConnect",
        });
        let result;
        try {
          result = await purchaseSquare(squareNumber, wagmi);
          const pendingUrl = buildTxUrl(result.hash);
          txUi.addPending(result.hash, pendingUrl);
          const transaction = await wagmi.waitForTransaction({ hash: result.hash });
          const txUrl = buildTxUrl(transaction.transactionHash);
          lastMintedSquare = squareNumber;
          showSuccessState(squareNumber);
          const personalizeHref = buildPersonalizeHref(squareNumber);
          txUi.markSuccess(
            transaction.transactionHash,
            txUrl,
            `Transaction confirmed. Next, go to the <a href="${personalizeHref}" target="_blank" rel="noreferrer" style="text-decoration: underline;">personalize page</a> to personalize your Square.`
          );
        } catch (error) {
          console.log(error);
          txUi.markError(error?.message || "Transaction failed");
          return alert(error?.message || "Transaction failed");
        }
      };
      await ensureConnected(async (clients) => {
        await ensureCorrectNetwork(clients);
        await doSendTransaction(clients);
      });
    });
  </script>
</body>

</html>
